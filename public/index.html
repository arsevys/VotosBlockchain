<!DOCTYPE html>
<html>
<head>
	<title>Votacion</title>
		<link rel="shortcut icon" href="favicon.ico">
		<link rel="stylesheet" type="text/css" href="css/normalize.css" />
		<link rel="stylesheet" type="text/css" href="css/demo.css" />
		<link rel="stylesheet" type="text/css" href="css/component.css" />

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/voto.css">

	

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<script src="js/web3.min.js"></script>
<script type="text/javascript" >

	var event =new EventSource("http://localhost:3500/evn");
   event.addEventListener("ola",function(e){
   	console.log(e);
   	toastr["info"]("Nuevo Voto Realisado");
   })
var abi=[
	{
		"constant": true,
		"inputs": [
			{
				"name": "k",
				"type": "address"
			}
		],
		"name": "viewVotante",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "total",
		"outputs": [
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "key",
				"type": "address"
			}
		],
		"name": "getP",
		"outputs": [
			{
				"name": "",
				"type": "string"
			},
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "l",
				"type": "address"
			}
		],
		"name": "comprobar",
		"outputs": [
			{
				"name": "",
				"type": "bool"
			},
			{
				"name": "",
				"type": "string"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "",
				"type": "uint256"
			}
		],
		"name": "cantidadVotantes",
		"type": "event"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "nom",
				"type": "string"
			},
			{
				"name": "ape",
				"type": "string"
			},
			{
				"name": "dni",
				"type": "string"
			},
			{
				"name": "ad",
				"type": "address"
			}
		],
		"name": "insertUsuario",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "",
				"type": "address"
			}
		],
		"name": "realisado",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "n1",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "p1",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "n2",
				"type": "string"
			},
			{
				"indexed": false,
				"name": "p2",
				"type": "uint256"
			},
			{
				"indexed": false,
				"name": "nc",
				"type": "address"
			}
		],
		"name": "tiempo",
		"type": "event"
	},
	{
		"constant": false,
		"inputs": [
			{
				"name": "llave",
				"type": "address"
			}
		],
		"name": "votar",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "",
				"type": "uint256"
			}
		],
		"name": "votosRealizados",
		"type": "event"
	}
]
            if (typeof web3 != 'undefined') { 
         console.log ("Uso de web3 detectado desde una fuente externa como Metamask") ;

       web3 = new Web3 (web3.currentProvider) 
      }
      else {// set the provider you want from Web3.providers
      	console.log("Se Requiere que utiize metamask");
      	$(".meta").css({"display":"block"});
      	$(" .primer").css({"display":"none"});
            /*web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));*/
        }

           if(!web3.isConnected()) {
                console.error("Not connectedd");

            }

  

   console.log(web3.eth.accounts);
       var Contract = web3.eth.contract(abi);

    var C = Contract.at('0x6d0e7883e04c85c8774052e23b53970e618e8a2e');
    
   C.tiempo((e,x)=>{
 console.log(e,x);
 	$(".uno").text(x.args.p1.c[0]);
      $(".dos").text(x.args.p2.c[0]);

      toastr["success"]("Voto realisado por "+ x.args.nc)
   })
    	
   console.log(C);
   C.total((a,b)=>{
   	console.log(a,b[1].c[0]);
   	$(".uno").text(b[1].c[0])
      $(".dos").text(b[3].c[0])
   })

    C.realisado((g,c)=>{
    	console.log(g,c.args);
    	console.log(g,c.args[""]);
    	toastr["success"]("Solicitud validado correctamente para "+c.args[""]);
    });
</script>

</head>
<body>

	<div class="b">
		<div><p>Conteo de Votos</p></div><br>
		<div>
			<span>Candidato X :</span>
			<strong><span class="uno">0</span></strong>
		</div>
		<div>
			<span>Candidato Y :</span>
			<strong><span class="dos">0</span></strong>
		</div>
	</div>

	<div class="container">
		<div class="meta" >
			<center>
				<br><br><br>
				<br>
				<br>
				<br>
				<h2>Esta plataforma requiere uso de METAMASK</h2>
				<br>
               
                <div>
                <a href="https://metamask.io/" target="_blank"><img src="imagen/dmeta.png" width="330" height="100"></a>
            </div>
			</center>
			
		</div>
		<div class="primer">
		<br><br><br><br>
		<center>
			
		<div class="imgVoto"><img src="imagen/voto.png" width="70px" heigth="50px"></div>	
		<br><br><br>
        <div>
			<h2>Votacion Privado</h2>
		</div>    

		<input type="text" placeholder="Insert Address" name="" class="iptKey">
		<br>

	   <input type="button" id="enviar" value ="Comprobar" name=""><br>
	
	 
<br>
	   <span class="msg efecto"></span>	</center>
      </div>


    <div class="segundo">
      <center>
      	<h2 style="color:black">Eligir Votante</h2>
      	<br>
      	<div class="votante">
      		<h4>Candidato X</h4>
      		<div><img src="imagen/can2.jpg" width="190px" height="200px"></div>
      		<label>0x2c50E3380C8D1B653cfE271139B2f1d57d1DDFa9</label><br><br>
      		<input type="checkbox" class="elegir" data-a="0x2c50E3380C8D1B653cfE271139B2f1d57d1DDFa9" name="vehicle" value="y">
      	</div>
      	<div class="votante">
      		<h4>Candidato Y</h4>
      		<div><img src="imagen/can1.jpg" width="190px" height="200px"></div>
      		<label>0xd1dbAe00541564cd6cEEC9992e06EcBBc87605eB</label><br><br>
      		<input type="checkbox" data-a="0xd1dbAe00541564cd6cEEC9992e06EcBBc87605eB" class="elegir" name="vehicle" value="x">
      	</div><br><br>
      	<input type="button" id="votar"  value ="Votar" name="">	</<br></center>
      </div>

<div class="tercero" style="display: none" >
	<center><br><br><br>
		<img src="imagen/completado.png" width="190" height="200"><br>
		<span class="efecto" style="color: white">Ah votado correctamente</span><br><br>
		<a class="efecto fr" href="#" target="_blank">ver Transaccion </a>
		
			</center>
</div>

	   </div>



</body>
<script src="js/custom-file-input.js"></script>
<script type="text/javascript" src="js/index.js"></script>
</html>